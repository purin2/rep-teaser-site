# 要件定義: preregistration-admin

## プロジェクト概要
事前登録ユーザー情報を保管するDBと、管理者が残り人数を操作できるAdmin機能

---

## 要件1: 事前登録データの保存

### 説明
ティザーサイトから送信された事前登録情報をデータベースに保存する。

### 受け入れ基準
- **EARS-1.1**: ユーザーがメールアドレスを入力して事前登録ボタンを押したとき、システムはメールアドレスと登録日時をデータベースに保存しなければならない
- **EARS-1.2**: ユーザーがアンケート（氏名、会社名、役職）を入力して完了ボタンを押したとき、システムは該当レコードにアンケート情報を追加保存しなければならない
- **EARS-1.3**: 同一メールアドレスで再度登録が試みられたとき、システムは重複エラーを返さなければならない
- **EARS-1.4**: システムは各登録に一意のIDを自動生成しなければならない

### データ項目
| フィールド | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| id | UUID | ○ | 一意識別子 |
| email | string | ○ | メールアドレス |
| name | string | - | 氏名 |
| company | string | - | 会社名 |
| position | string | - | 役職 |
| created_at | timestamp | ○ | 登録日時 |
| updated_at | timestamp | ○ | 更新日時 |

---

## 要件2: 残り人数の管理

### 説明
管理者がマーケティング状況に応じて残り人数を手動で設定できる。

### 受け入れ基準
- **EARS-2.1**: システムは残り人数を設定テーブルで管理しなければならない
- **EARS-2.2**: 管理者が残り人数を変更したとき、システムは即座にティザーサイトに反映しなければならない
- **EARS-2.3**: システムは残り人数の変更履歴（変更日時、変更前の値、変更後の値）を記録しなければならない
- **EARS-2.4**: 残り人数が0になったとき、システムは事前登録の受付を停止しなければならない

### 設定データ項目
| フィールド | 型 | 説明 |
|-----------|-----|------|
| key | string | 設定キー（例: remaining_count） |
| value | integer | 残り人数 |
| updated_at | timestamp | 最終更新日時 |
| updated_by | string | 更新者 |

---

## 要件3: 管理者認証

### 説明
管理画面へのアクセスを認証で保護する。

### 受け入れ基準
- **EARS-3.1**: 管理画面にアクセスしたとき、システムは認証を要求しなければならない
- **EARS-3.2**: 認証されていないユーザーが管理APIにアクセスしたとき、システムは401エラーを返さなければならない
- **EARS-3.3**: システムはセッションを一定時間（24時間）で自動的に失効させなければならない

---

## 要件4: 管理ダッシュボード

### 説明
管理者が登録状況を監視し、残り人数を操作できるダッシュボード。

### 受け入れ基準
- **EARS-4.1**: 管理者がダッシュボードにアクセスしたとき、システムは以下の情報を表示しなければならない：
  - 現在の残り人数
  - 総登録者数
  - 本日の登録者数
  - 登録者一覧（ページネーション付き）
- **EARS-4.2**: 管理者が残り人数フィールドを編集して保存したとき、システムは値を更新しなければならない
- **EARS-4.3**: 管理者が登録者一覧でCSVエクスポートボタンを押したとき、システムは全登録者データをCSV形式でダウンロードさせなければならない
- **EARS-4.4**: 管理者が検索フィールドに入力したとき、システムはメールアドレス・氏名・会社名で絞り込み検索を行わなければならない

---

## 要件5: ティザーサイト連携API

### 説明
フロントエンド（ティザーサイト）とバックエンドを接続するAPI。

### 受け入れ基準
- **EARS-5.1**: ティザーサイトがAPIを呼び出したとき、システムは現在の残り人数を返さなければならない
- **EARS-5.2**: ティザーサイトが事前登録リクエストを送信したとき、システムはデータを保存して成功/失敗を返さなければならない
- **EARS-5.3**: APIはCORS設定により、許可されたオリジンからのみアクセス可能でなければならない
- **EARS-5.4**: 残り人数が0のとき、事前登録APIは受付終了エラーを返さなければならない

### APIエンドポイント（案）
| メソッド | パス | 説明 |
|---------|------|------|
| GET | /api/count | 残り人数取得 |
| POST | /api/register | 事前登録（メール） |
| PATCH | /api/register/:id | アンケート追加 |

---

## 非機能要件

### パフォーマンス
- APIレスポンスは500ms以内
- 同時100リクエストに耐えられること

### セキュリティ
- 管理APIは認証必須
- メールアドレスは暗号化して保存（推奨）
- HTTPS必須

### 可用性
- 99%以上の稼働率

---

*生成日時: 2026-01-28*
*ステータス: レビュー待ち*
